<!DOCTYPE html>
<html lang="zh">


<!-- Mirrored from 2fa.fun/note-sharing.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 13 Oct 2025 12:07:05 GMT -->
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <meta property="og:title" content="在线笔记分享工具-带密码保护的临时笔记">
    <meta property="og:type" content="article">
    <meta property="og:url" content="index.html">
    <meta name="author" content="2fa在线工具网站">
    <meta property="og:image:alt" content="带密码保护的在线笔记">
    <meta name="keywords" content="在线笔记,密码保护笔记,临时笔记,无数据库笔记,安全笔记分享">
    <meta property="og:description" content="带密码保护的在线笔记分享工具，无需注册，笔记内容加密存储，支持本地保存和安全分享，保护你的私密信息。">
    <title>在线笔记分享工具-带密码保护的临时笔记</title>
    <!-- Favicon-->
    <link rel="shortcut icon" href="static/picture/favicon.png">

    <!-- 外部资源 -->
    <script src="https://cdn.tailwindcss.com/"></script>
    <link href="../cdn.jsdelivr.net/npm/font-awesome%404.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="../cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js"></script>
    <!-- 加密库：AES-256-CBC加密依赖 -->
    <script src="../cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

    <link href="static/css/icon.css" rel="stylesheet" type="text/css">
    <link href="static/css/toastr.min.css" rel="stylesheet" type="text/css">
    <link href="static/css/select2.css" rel="stylesheet" type="text/css">
    <link href="static/css/app.min.css" media="all" type="text/css" rel="stylesheet">
    <link href="static/css/custom-style.css" rel="stylesheet" type="text/css">

    <style>
        /* 基础样式保持一致 */
        .sidebar-link.active {
            background-color: rgba(79, 70, 229, 0.1);
            border-left: 3px solid #4f46e5;
        }
        .sidebar-link:hover {
            background-color: rgba(79, 70, 229, 0.05);
            transition: all 0.3s ease;
        }
        .card {
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .btn-primary {
            background-color: #4f46e5;
            border-color: #4f46e5;
        }
        .btn-primary:hover {
            background-color: #4338ca;
            border-color: #4338ca;
        }
        .btn-success {
            background-color: #10b981;
            border-color: #10b981;
        }
        .btn-success:hover {
            background-color: #059669;
            border-color: #059669;
        }
        .btn-secondary {
            background-color: #64748b;
            border-color: #64748b;
        }
        .btn-secondary:hover {
            background-color: #475569;
            border-color: #475569;
        }
        .instructions {
            background-color: #f8fafc;
            border-radius: 0.5rem;
            border: 1px solid #e2e8f0;
        }
        .note-container {
            min-height: 300px;
        }
        .share-link-container {
            display: none;
        }
        .alert-message {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            padding: 1rem;
            border-radius: 0.5rem;
            color: white;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .alert-success {
            background-color: #10b981;
        }
        .alert-error {
            background-color: #ef4444;
        }
        /* 密码保护相关样式 */
        .password-section {
            padding: 1rem;
            background-color: #f1f5f9;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
        }
        .strength-container {
            margin-top: 0.5rem;
            height: 8px;
            width: 100%;
            background-color: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
        }
        .strength-bar {
            height: 100%;
            width: 0%;
            transition: width 0.3s ease, background-color 0.3s ease;
        }
        .strength-text {
            font-size: 0.875rem;
            margin-top: 0.5rem;
        }
        /* 密码弹窗样式 */
        .password-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        .password-modal.active {
            opacity: 1;
            pointer-events: all;
        }
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 0.5rem;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .error-count {
            font-size: 0.875rem;
            color: #ef4444;
            margin-top: 0.5rem;
            display: none;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="app is-default flex h-screen overflow-hidden">
        <!-- 侧边导航（与其他页面一致） -->
        <div class="w-64 bg-white shadow-lg z-10 hidden md:block">
            <div class="p-4 border-b">
                <div class="flex items-center">
                    <img src="static/picture/2falogo.png" alt="2FA工具" class="h-10">
                </div>
            </div>
            
            <nav class="p-4">
                <p class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2">菜单</p>
                <ul>
                    <li class="mb-1">
                        <a href="2fa-otp.html" class="sidebar-link flex items-center px-3 py-2 text-gray-700 rounded-md">
                            <i class="fa fa-key w-5 text-indigo-500 mr-3"></i>
                            <span>获取2FA验证码</span>
                        </a>
                    </li>
                    <li class="mb-1">
                        <a href="check-live.html" class="sidebar-link flex items-center px-3 py-2 text-gray-700 rounded-md">
                            <i class="fa fa-refresh w-5 text-emerald-500 mr-3"></i>
                            <span>检测FB账户存活</span>
                        </a>
                    </li>
                    <li class="mb-1">
                        <a href="email-reader.html" class="sidebar-link flex items-center px-3 py-2 text-gray-700 rounded-md">
                            <i class="fa fa-envelope w-5 text-emerald-500 mr-3"></i>
                            <span>快速阅读邮件</span>
                        </a>
                    </li>
                    <li class="mb-1">
                        <a href="text-processor.html" class="sidebar-link flex items-center px-3 py-2 text-gray-700 rounded-md">
                            <i class="fa fa-file-text w-5 text-indigo-500 mr-3"></i>
                            <span>在线文本处理</span>
                        </a>
                    </li>
                    <li class="mb-1">
                        <a href="note-sharing.html" class="sidebar-link active flex items-center px-3 py-2 text-gray-700 rounded-md">
                            <i class="fa fa-sticky-note w-5 text-indigo-500 mr-3"></i>
                            <span>在线笔记分享</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
        
        <!-- 移动端菜单按钮 -->
        <div class="md:hidden fixed bottom-4 right-4 z-50">
            <button id="mobile-menu-button" class="bg-indigo-600 text-white p-3 rounded-full shadow-lg">
                <i class="fa fa-bars"></i>
            </button>
        </div>
        
        <!-- 移动端侧边栏 -->
        <div id="mobile-sidebar" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden md:hidden">
            <div class="bg-white h-full w-64 p-4 transform transition-transform">
                <div class="flex justify-between items-center mb-6">
                    <div class="flex items-center">
                        <img src="static/picture/2falogo.png" alt="2FA工具" class="h-8">
                    </div>
                    <button id="close-menu" class="text-gray-500">
                        <i class="fa fa-times text-xl"></i>
                    </button>
                </div>
                
                <nav>
                    <p class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2">菜单</p>
                    <ul>
                        <li class="mb-1">
                            <a href="2fa-otp.html" class="sidebar-link flex items-center px-3 py-2 text-gray-700 rounded-md">
                                <i class="fa fa-key w-5 text-indigo-500 mr-3"></i>
                                <span>获取2FA验证码</span>
                            </a>
                        </li>
                        <li class="mb-1">
                            <a href="check-live.html" class="sidebar-link flex items-center px-3 py-2 text-gray-700 rounded-md">
                                <i class="fa fa-refresh w-5 text-emerald-500 mr-3"></i>
                                <span>检测FB账户存活</span>
                            </a>
                        </li>
                        <li class="mb-1">
                            <a href="email-reader.html" class="sidebar-link flex items-center px-3 py-2 text-gray-700 rounded-md">
                                <i class="fa fa-envelope w-5 text-emerald-500 mr-3"></i>
                                <span>快速阅读邮件</span>
                            </a>
                        </li>
                        <li class="mb-1">
                            <a href="text-processor.html" class="sidebar-link flex items-center px-3 py-2 text-gray-700 rounded-md">
                                <i class="fa fa-file-text w-5 text-indigo-500 mr-3"></i>
                                <span>在线文本处理</span>
                            </a>
                        </li>
                        <li class="mb-1">
                            <a href="note-sharing.html" class="sidebar-link active flex items-center px-3 py-2 text-gray-700 rounded-md">
                                <i class="fa fa-sticky-note w-5 text-indigo-500 mr-3"></i>
                                <span>在线笔记分享</span>
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>

        <!-- 主内容区域 -->
        <div class="flex-1 overflow-y-auto bg-gray-50">
            <div class="container mx-auto p-4 md:p-6">
                <div class="card bg-white p-6 mt-4">
                    <h1 class="text-2xl font-bold text-gray-800 mb-6">在线笔记分享工具（带密码保护）</h1>

                    <div class="space-y-6">
                        <!-- 笔记标题 -->
                        <div class="form-group">
                            <label for="note-title" class="block text-gray-700 font-medium mb-2">笔记标题</label>
                            <input type="text" id="note-title" class="form-control w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" 
                                   placeholder="给你的笔记起个标题...">
                        </div>

                        <!-- 笔记内容 -->
                        <div class="form-group">
                            <label for="note-content" class="block text-gray-700 font-medium mb-2">笔记内容</label>
                            <textarea id="note-content" class="form-control w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 note-container" 
                                    placeholder="在这里输入笔记内容...支持文本格式，可用于临时分享信息、代码片段等。" rows="10"></textarea>
                        </div>

                        <!-- 密码保护区域 -->
                        <div class="password-section">
                            <div class="flex items-center justify-between mb-2">
                                <label class="block text-gray-700 font-medium">密码保护设置</label>
                                <label class="inline-flex items-center cursor-pointer">
                                    <input type="checkbox" id="enable-password" class="sr-only peer">
                                    <div class="relative w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-indigo-500 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600"></div>
                                    <span class="ml-2 text-sm text-gray-700">启用密码保护</span>
                                </label>
                            </div>
                            
                            <div id="password-input-container" class="hidden">
                                <input type="password" id="note-password" class="form-control w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" 
                                       placeholder="设置访问密码（建议≥8位，包含字母和数字）">
                                <div class="strength-container">
                                    <div id="strength-bar" class="strength-bar"></div>
                                </div>
                                <p id="strength-text" class="strength-text text-gray-500">请输入密码查看强度</p>
                            </div>
                        </div>

                        <!-- 操作按钮 -->
                        <div class="flex flex-wrap gap-3">
                            <button id="btn-new-note" class="btn btn-secondary px-4 py-2 rounded-md font-medium text-white shadow-sm hover:bg-gray-700 focus:outline-none">
                                <i class="fa fa-file-o mr-2"></i> 新建笔记
                            </button>
                            <button id="btn-save-local" class="btn btn-primary px-4 py-2 rounded-md font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none">
                                <i class="fa fa-save mr-2"></i> 保存到本地
                            </button>
                            <button id="btn-generate-link" class="btn btn-success px-4 py-2 rounded-md font-medium text-white shadow-sm hover:bg-green-700 focus:outline-none">
                                <i class="fa fa-link mr-2"></i> 生成分享链接
                            </button>
                        </div>
                        
                        <!-- 分享链接区域 -->
                        <div class="share-link-container card p-4 bg-gray-50" id="share-link-container">
                            <label class="block text-gray-700 font-medium mb-2">
                                <span id="link-type-text">普通分享链接</span>
                                <span id="encrypted-tag" class="ml-2 px-2 py-0.5 bg-red-100 text-red-800 text-xs rounded-full hidden">已加密</span>
                            </label>
                            <div class="flex flex-wrap gap-2">
                                <input type="text" id="share-link" class="form-control flex-grow px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none" readonly>
                                <button id="btn-copy-link" class="btn btn-primary px-4 py-2 rounded-md font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none" data-clipboard-target="#share-link">
                                    <i class="fa fa-copy mr-1"></i> 复制
                                </button>
                            </div>
                            <p class="mt-2 text-sm text-gray-500">
                                <i class="fa fa-info-circle mr-1"></i> 
                                <span id="link-desc">其他人可以通过此链接查看你的笔记，笔记内容存储在链接中</span>
                            </p>
                        </div>

                        <!-- 使用说明区域 -->
                        <div class="instructions p-5 mt-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-3 flex items-center">
                                <i class="fa fa-info-circle text-indigo-500 mr-2"></i> 使用说明
                            </h3>
                            <ol class="list-decimal list-inside space-y-2 text-gray-700">
                                <li>在上方输入笔记标题和内容</li>
                                <li>（可选）开启"密码保护"，设置访问密码（建议≥8位，包含字母和数字）</li>
                                <li>点击"保存到本地"可将笔记保存在当前设备，方便后续编辑</li>
                                <li>点击"生成分享链接"可创建包含笔记内容的分享链接：
                                    <ul class="list-disc list-inside ml-4 mt-1 text-sm">
                                        <li>普通链接：直接访问即可查看笔记</li>
                                        <li>加密链接：需要输入正确密码才能查看内容</li>
                                    </ul>
                                </li>
                                <li>将生成的链接分享给他人，对方打开链接即可查看（加密链接需输入密码）</li>
                                <li>点击"新建笔记"可清空当前内容，开始创建新笔记</li>
                            </ol>
                            <div class="mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-md">
                                <h4 class="font-medium text-yellow-800 mb-1 flex items-center">
                                    <i class="fa fa-lightbulb-o mr-2"></i> 重要提示
                                </h4>
                                <ul class="list-disc list-inside text-sm text-yellow-700 space-y-1">
                                    <li>本地保存：仅在当前设备+当前浏览器有效，清除浏览器数据会丢失</li>
                                    <li>链接分享：无过期时间，但链接丢失/过长（超过2083字符）可能无法访问</li>
                                    <li>密码保护：密码仅由你保管，忘记密码无法恢复加密笔记</li>
                                    <li>隐私安全：不建议存储身份证、银行卡等高度敏感信息</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 密码验证弹窗 -->
    <div id="password-modal" class="password-modal">
        <div class="modal-content">
            <h3 class="text-xl font-bold text-gray-800 mb-4">此笔记已加密</h3>
            <p class="text-gray-600 mb-4">请输入访问密码查看内容</p>
            <input type="password" id="verify-password" class="form-control w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 mb-3" 
                   placeholder="输入访问密码">
            <p id="verify-error" class="text-red-500 text-sm mb-3 hidden">密码错误，请重新输入</p>
            <p id="verify-count" class="error-count">已连续错误3次，请稍后再试</p>
            <div class="flex justify-end gap-2">
                <button id="cancel-verify" class="btn btn-secondary px-4 py-2 rounded-md font-medium text-white shadow-sm hover:bg-gray-700 focus:outline-none">
                    取消
                </button>
                <button id="confirm-verify" class="btn btn-primary px-4 py-2 rounded-md font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none">
                    确认
                </button>
            </div>
        </div>
    </div>

    <!-- 提示消息组件 -->
    <div id="alert-message" class="alert-message"></div>

    <!-- 移动端菜单控制 -->
    <script>
        document.getElementById('mobile-menu-button').addEventListener('click', function() {
            document.getElementById('mobile-sidebar').classList.remove('hidden');
        });
        
        document.getElementById('close-menu').addEventListener('click', function() {
            document.getElementById('mobile-sidebar').classList.add('hidden');
        });
        
        document.getElementById('mobile-sidebar').addEventListener('click', function(e) {
            if (e.target === this) {
                this.classList.add('hidden');
            }
        });
    </script>

    <!-- 笔记分享核心功能（含密码保护） -->
    <script>
        // DOM元素
        const noteTitle = document.getElementById('note-title');
        const noteContent = document.getElementById('note-content');
        const enablePassword = document.getElementById('enable-password');
        const passwordInputContainer = document.getElementById('password-input-container');
        const notePassword = document.getElementById('note-password');
        const strengthBar = document.getElementById('strength-bar');
        const strengthText = document.getElementById('strength-text');
        const shareLinkContainer = document.getElementById('share-link-container');
        const shareLink = document.getElementById('share-link');
        const linkTypeText = document.getElementById('link-type-text');
        const encryptedTag = document.getElementById('encrypted-tag');
        const linkDesc = document.getElementById('link-desc');
        const alertMessage = document.getElementById('alert-message');
        const passwordModal = document.getElementById('password-modal');
        const verifyPassword = document.getElementById('verify-password');
        const verifyError = document.getElementById('verify-error');
        const verifyCount = document.getElementById('verify-count');
        const confirmVerify = document.getElementById('confirm-verify');
        const cancelVerify = document.getElementById('cancel-verify');
        
        // 全局变量
        let errorCount = 0; // 密码错误计数器
        let secureNoteData = null; // 加密笔记数据缓存

        // 显示提示消息
        function showAlert(message, isSuccess = true) {
            alertMessage.textContent = message;
            alertMessage.className = `alert-message ${isSuccess ? 'alert-success' : 'alert-error'}`;
            alertMessage.style.opacity = '1';
            
            setTimeout(() => {
                alertMessage.style.opacity = '0';
            }, 3000);
        }

        // 密码强度检测
        function calculatePasswordStrength(password) {
            let strength = 0;
            
            // 长度检测（每4字符+1分，最高3分）
            if (password.length >= 4) strength += Math.min(Math.floor(password.length / 4), 3);
            
            // 字符类型检测（每种类型+1分，最高2分）
            if (/[a-z]/.test(password)) strength++;
            if (/[A-Z]/.test(password)) strength++;
            if (/[0-9]/.test(password)) strength++;
            if (/[^a-zA-Z0-9]/.test(password)) strength++;
            
            return Math.min(strength, 5); // 最高5级
        }

        // 更新密码强度显示
        function updatePasswordStrength(password) {
            const strength = calculatePasswordStrength(password);
            const [color, text] = [
                ['#FF4444', '极弱：容易被破解'],    // 1级
                ['#FF8800', '弱：建议增加长度'],    // 2级
                ['#FFCC00', '中等：可增加复杂度'],  // 3级
                ['#8BBD00', '强：安全性良好'],      // 4级
                ['#00C851', '极强：安全性优秀']     // 5级
            ][strength - 1] || ['#FF4444', '极弱：容易被破解'];
            
            strengthBar.style.backgroundColor = color;
            strengthBar.style.width = `${strength * 20}%`;
            strengthText.textContent = text;
            strengthText.style.color = color;
        }

        // URL安全编码（处理Base64特殊字符）
        function urlSafeEncode(str) {
            return btoa(unescape(encodeURIComponent(str)))
                .replace(/\+/g, '-')
                .replace(/\//g, '_')
                .replace(/=+$/, '');
        }

        // URL安全解码
        function urlSafeDecode(encodedStr) {
            try {
                // 补全Base64填充符
                const paddingLength = (4 - (encodedStr.length % 4)) % 4;
                const paddedStr = encodedStr + '='.repeat(paddingLength);
                
                return decodeURIComponent(escape(atob(
                    paddedStr.replace(/-/g, '+').replace(/_/g, 'index.html')
                )));
            } catch (e) {
                console.error('解码失败:', e);
                return null;
            }
        }

        // 加密笔记内容（AES-256-CBC）
        function encryptNote(title, content, password) {
            try {
                // 生成随机IV（16字节，AES-CBC要求）
                const iv = CryptoJS.lib.WordArray.random(16);
                
                // 待加密的数据（包含标题和内容）
                const noteData = JSON.stringify({ title, content, timestamp: new Date().toISOString() });
                
                // AES加密（密码作为密钥，IV作为初始化向量）
                const encrypted = CryptoJS.AES.encrypt(noteData, password, {
                    iv: iv,
                    mode: CryptoJS.mode.CBC,
                    padding: CryptoJS.pad.Pkcs7
                });
                
                // 生成密码哈希（用于验证，不存储原始密码）
                const passwordHash = CryptoJS.SHA256(password).toString();
                
                // 返回加密后的数据（IV和密文都需Base64编码）
                return {
                    iv: iv.toString(CryptoJS.enc.Base64),
                    ciphertext: encrypted.ciphertext.toString(CryptoJS.enc.Base64),
                    passwordHash: passwordHash
                };
            } catch (e) {
                console.error('加密失败:', e);
                return null;
            }
        }

        // 解密笔记内容
        function decryptNote(encryptedData, password) {
            try {
                // 先验证密码哈希（避免无效解密）
                const inputHash = CryptoJS.SHA256(password).toString();
                if (inputHash !== encryptedData.passwordHash) {
                    return { success: false, message: '密码错误' };
                }
                
                // 解码IV和密文
                const iv = CryptoJS.enc.Base64.parse(encryptedData.iv);
                const ciphertext = CryptoJS.enc.Base64.parse(encryptedData.ciphertext);
                
                // AES解密
                const decrypted = CryptoJS.AES.decrypt(
                    { ciphertext: ciphertext },
                    password,
                    { iv: iv, mode: CryptoJS.mode.CBC, padding: CryptoJS.pad.Pkcs7 }
                );
                
                // 解析解密后的内容
                const noteData = JSON.parse(decrypted.toString(CryptoJS.enc.Utf8));
                return { success: true, data: noteData };
            } catch (e) {
                console.error('解密失败:', e);
                return { success: false, message: '解密失败，请检查密码' };
            }
        }

        // 生成分享链接（区分普通/加密）
        function generateShareLink() {
            const title = noteTitle.value.trim() || '无标题笔记';
            const content = noteContent.value.trim();
            
            if (!content) {
                showAlert('请输入笔记内容后再生成分享链接', false);
                return;
            }

            // 普通链接（无密码保护）
            if (!enablePassword.checked) {
                const noteData = { title, content, timestamp: new Date().toISOString() };
                const encodedData = urlSafeEncode(JSON.stringify(noteData));
                const url = `${window.location.origin}${window.location.pathname}?note=${encodedData}`;
                
                shareLink.value = url;
                shareLinkContainer.style.display = 'block';
                linkTypeText.textContent = '普通分享链接';
                encryptedTag.classList.add('hidden');
                linkDesc.textContent = '其他人可以通过此链接直接查看你的笔记，笔记内容存储在链接中';
                showAlert('普通分享链接已生成');
                return;
            }

            // 加密链接（有密码保护）
            const password = notePassword.value.trim();
            if (!password || password.length < 6) {
                showAlert('请设置至少6位的访问密码', false);
                notePassword.focus();
                return;
            }

            const encryptedData = encryptNote(title, content, password);
            if (!encryptedData) {
                showAlert('加密失败，请重试', false);
                return;
            }

            const encodedData = urlSafeEncode(JSON.stringify(encryptedData));
            const url = `${window.location.origin}${window.location.pathname}?secure=${encodedData}`;
            
            shareLink.value = url;
            shareLinkContainer.style.display = 'block';
            linkTypeText.textContent = '加密分享链接';
            encryptedTag.classList.remove('hidden');
            linkDesc.textContent = '其他人需要输入正确密码才能查看笔记，内容已加密保护';
            showAlert('加密分享链接已生成（密码请妥善保管）');
        }

        // 加载普通笔记（无密码）
        function loadNormalNote(encodedData) {
            try {
                const decodedStr = urlSafeDecode(encodedData);
                if (!decodedStr) {
                    showAlert('笔记数据解析失败', false);
                    return;
                }

                const noteData = JSON.parse(decodedStr);
                noteTitle.value = noteData.title || '无标题笔记';
                noteContent.value = noteData.content || '';
                
                // 显示分享链接（当前URL）
                shareLink.value = window.location.href;
                shareLinkContainer.style.display = 'block';
                linkTypeText.textContent = '普通分享链接';
                encryptedTag.classList.add('hidden');
            } catch (e) {
                console.error('加载普通笔记失败:', e);
                showAlert('无法加载笔记内容', false);
            }
        }

        // 加载加密笔记（需要密码）
        function loadSecureNote(encodedData) {
            try {
                const decodedStr = urlSafeDecode(encodedData);
                if (!decodedStr) {
                    showAlert('加密笔记数据解析失败', false);
                    return;
                }

                secureNoteData = JSON.parse(decodedStr);
                // 显示密码弹窗
                passwordModal.classList.add('active');
                verifyPassword.focus();
            } catch (e) {
                console.error('加载加密笔记失败:', e);
                showAlert('无法加载加密笔记', false);
            }
        }

        // 验证密码并显示加密笔记
        function verifyAndShowNote() {
            if (errorCount >= 3) {
                verifyCount.style.display = 'block';
                confirmVerify.disabled = true;
                confirmVerify.style.opacity = '0.6';
                return;
            }

            const password = verifyPassword.value.trim();
            if (!password) {
                verifyError.textContent = '请输入访问密码';
                verifyError.classList.remove('hidden');
                verifyPassword.focus();
                return;
            }

            const result = decryptNote(secureNoteData, password);
            if (result.success) {
                // 解密成功，显示笔记
                noteTitle.value = result.data.title || '无标题笔记';
                noteContent.value = result.data.content || '';
                passwordModal.classList.remove('active');
                
                // 显示分享链接
                shareLink.value = window.location.href;
                shareLinkContainer.style.display = 'block';
                linkTypeText.textContent = '加密分享链接';
                encryptedTag.classList.remove('hidden');
                linkDesc.textContent = '其他人需要输入正确密码才能查看笔记，内容已加密保护';
                
                showAlert('密码正确，已加载笔记内容');
                errorCount = 0; // 重置错误计数器
                verifyError.classList.add('hidden');
                verifyCount.style.display = 'none';
                verifyPassword.value = '';
            } else {
                // 解密失败，增加错误计数
                errorCount++;
                verifyError.textContent = errorCount < 3 ? '密码错误，请重新输入' : '已连续错误3次，请稍后再试';
                verifyError.classList.remove('hidden');
                verifyPassword.value = '';
                verifyPassword.focus();
                
                if (errorCount >= 3) {
                    verifyCount.style.display = 'block';
                    confirmVerify.disabled = true;
                    confirmVerify.style.opacity = '0.6';
                }
            }
        }

        // 保存笔记到本地存储
        function saveNoteToLocal() {
            const title = noteTitle.value.trim() || '无标题笔记';
            const content = noteContent.value.trim();
            
            if (!content) {
                showAlert('笔记内容为空，无需保存', false);
                return;
            }

            // 如果启用了密码保护，本地保存也加密
            let savedData = { title, content, lastModified: new Date().toISOString() };
            let isEncrypted = false;

            if (enablePassword.checked && notePassword.value.trim()) {
                const encrypted = encryptNote(title, content, notePassword.value.trim());
                if (encrypted) {
                    savedData = { ...encrypted, isLocalEncrypted: true };
                    isEncrypted = true;
                }
            }

            localStorage.setItem('lastNote', JSON.stringify(savedData));
            showAlert(`笔记已保存到本地${isEncrypted ? '（已加密）' : ''}`);
        }

        // 从本地存储加载笔记
        function loadLocalNote() {
            const savedStr = localStorage.getItem('lastNote');
            if (!savedStr) return;

            try {
                const savedData = JSON.parse(savedStr);
                // 本地加密笔记需要密码
                if (savedData.isLocalEncrypted) {
                    secureNoteData = savedData;
                    passwordModal.classList.add('active');
                    verifyPassword.focus();
                    verifyError.textContent = '此本地笔记已加密，请输入密码解锁';
                    verifyError.classList.remove('hidden');
                } else {
                    // 普通本地笔记直接显示
                    noteTitle.value = savedData.title || '';
                    noteContent.value = savedData.content || '';
                    showAlert('已加载本地保存的笔记');
                }
            } catch (e) {
                console.error('加载本地笔记失败:', e);
                showAlert('本地笔记损坏，无法加载', false);
            }
        }

        // 新建笔记
        function newNote() {
            if (noteContent.value.trim() || noteTitle.value.trim()) {
                if (!confirm('确定要创建新笔记吗？当前内容将被清空（未保存的内容会丢失）')) {
                    return;
                }
            }

            noteTitle.value = '';
            noteContent.value = '';
            enablePassword.checked = false;
            passwordInputContainer.classList.add('hidden');
            notePassword.value = '';
            shareLinkContainer.style.display = 'none';
            strengthBar.style.width = '0%';
            strengthText.textContent = '请输入密码查看强度';
            strengthText.style.color = '#64748b';
            errorCount = 0;
            verifyError.classList.add('hidden');
            verifyCount.style.display = 'none';
            confirmVerify.disabled = false;
            confirmVerify.style.opacity = '1';
            showAlert('已准备好创建新笔记');
        }

        // 事件监听 - 密码保护开关
        enablePassword.addEventListener('change', function() {
            if (this.checked) {
                passwordInputContainer.classList.remove('hidden');
                notePassword.focus();
            } else {
                passwordInputContainer.classList.add('hidden');
            }
        });

        // 事件监听 - 密码输入实时检测强度
        notePassword.addEventListener('input', function() {
            updatePasswordStrength(this.value.trim());
        });

        // 事件监听 - 按钮点击
        document.getElementById('btn-generate-link').addEventListener('click', generateShareLink);
        document.getElementById('btn-save-local').addEventListener('click', saveNoteToLocal);
        document.getElementById('btn-new-note').addEventListener('click', newNote);
        document.getElementById('confirm-verify').addEventListener('click', verifyAndShowNote);
        document.getElementById('cancel-verify').addEventListener('click', function() {
            passwordModal.classList.remove('active');
            verifyPassword.value = '';
            verifyError.classList.add('hidden');
        });

        // 事件监听 - 密码弹窗回车确认
        verifyPassword.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                verifyAndShowNote();
            }
        });

        // 初始化复制功能
        document.addEventListener('DOMContentLoaded', function() {
            const clipboard = new ClipboardJS('#btn-copy-link');
            
            clipboard.on('success', function() {
                showAlert('链接已复制到剪贴板');
            });
            
            clipboard.on('error', function() {
                showAlert('复制失败，请手动复制', false);
            });

            // 页面加载时检查URL参数（普通笔记/加密笔记）
            const params = new URLSearchParams(window.location.search);
            const normalNote = params.get('note');
            const secureNote = params.get('secure');

            if (secureNote) {
                // 加载加密笔记
                loadSecureNote(secureNote);
            } else if (normalNote) {
                // 加载普通笔记
                loadNormalNote(normalNote);
            } else {
                // 没有URL参数，尝试加载本地笔记
                loadLocalNote();
            }
        });
    </script>

    <!-- Core Vendors JS -->
    <script src="static/js/vendors.min.js"></script>
    <!-- Core JS -->
    <script src="static/js/app.min.js"></script>

    <!-- Other JS plugins -->
    <script src="static/js/toastr.min.js"></script>
    <script src="static/js/sweetalert.min.js"></script>
    <script src="static/js/moment.js"></script>
    <script src="static/js/autosize.min.js"></script>
    <script src="static/js/select2.min.js"></script>

    <!-- axios -->
    <script src="static/js/axios.min-1.js"></script>

    <!--User defined js code -->
    <script src="static/js/common.js"></script>

    <script src="static/js/platform.js" async="" defer=""></script>
    <script src="static/js/auth.js"></script>
</body>


<!-- Mirrored from 2fa.fun/note-sharing.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 13 Oct 2025 12:07:06 GMT -->
</html>
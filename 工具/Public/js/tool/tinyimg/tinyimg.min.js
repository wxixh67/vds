var compressedFiles=[];function updateFileCount(){var e=document.getElementById("fileInput").files.length;document.getElementById("fileCount").innerText=e}document.getElementById("fileInput").addEventListener("change",updateFileCount);let dropArea=document.getElementById("dropArea");async function compressImages(){var e=document.getElementById("fileInput").files;if(!e.length)return cocoMessage.error("请先选择图片！",3e3);compressedFiles=[],document.getElementById("preview").innerHTML="";for(let d of e)try{var t=(d.size/1024).toFixed(2)+" KB",r={maxSizeMB:parseFloat(document.querySelector("#maxSizeMB").value),maxWidthOrHeight:parseFloat(document.querySelector("#maxWidthOrHeight").value),useWebWorker:!0},n=await imageCompression(d,r),a=(n.size/1024).toFixed(2)+" KB",o=new File([n],d.name,{type:d.type});compressedFiles.push(o),showPreview(n,d.name,t,a)}catch(e){console.error("压缩失败:",e),cocoMessage.error("压缩失败！",3e3)}compressedFiles.length>0&&(document.getElementById("downloadAll").style.display="inline-block")}function showPreview(e,t,r,n){var a=new FileReader;a.onload=function(e){var a=document.createElement("div");a.className="image-wrapper";var o=document.createElement("img");o.src=e.target.result,o.alt=t;var d=document.createElement("p");d.className="size-info",d.innerHTML=`原大小: ${r}<br>压缩后: ${n}`,a.appendChild(o),a.appendChild(d),document.getElementById("preview").appendChild(a)},a.readAsDataURL(e)}function downloadAllImages(){compressedFiles.length&&compressedFiles.forEach(e=>{var t=document.createElement("a");t.href=URL.createObjectURL(e),t.download=e.name,document.body.appendChild(t),t.click(),document.body.removeChild(t)})}dropArea.addEventListener("click",()=>document.getElementById("fileInput").click()),dropArea.addEventListener("dragover",e=>{e.preventDefault(),dropArea.style.borderColor="#333"}),dropArea.addEventListener("dragleave",()=>dropArea.style.borderColor="#aaa"),dropArea.addEventListener("drop",e=>{e.preventDefault(),dropArea.style.borderColor="#aaa",document.getElementById("fileInput").files=e.dataTransfer.files,updateFileCount()});
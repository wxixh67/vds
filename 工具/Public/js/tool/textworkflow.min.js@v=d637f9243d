var operations=[];function saveOperationsToLocalStorage(){localStorage.setItem("iamwawa_cn_operations",JSON.stringify(operations))}function loadSavedOperations(){var e=localStorage.getItem("iamwawa_cn_operations");null===e?$("#operationList").html($("<p>").addClass("flow-tips").html("请先添加操作<br/><button class='btn btn-round' onclick='loadExample();'>载入示例</button>")):(operations=JSON.parse(e),displayOperations())}function clearOperations(){operations=[],localStorage.removeItem("iamwawa_cn_operations"),displayOperations()}function addAction(e){if(19<operations.length)return cocoMessage.error("操作不能超过20个",3e3),!1;switch(e){case"addLineNumbers":operations.push({type:"addLineNumbers",mode:"number",separator:". "});break;case"addPrefix":operations.push({type:"addPrefix",text:""});break;case"addSuffix":operations.push({type:"addSuffix",text:""});break;case"convertCase":operations.push({type:"convertCase",mode:"uppercase"});break;case"convertLineBreaks":operations.push({type:"convertLineBreaks",option:"comma2break"});break;case"deleteCharacters":operations.push({type:"deleteCharacters",option:"number",text:"",isShowText:"none"});break;case"encodeAndDecode":operations.push({type:"encodeAndDecode",option:"encodeBase64",mode:"line"});break;case"removeDuplicates":operations.push({type:"removeDuplicates",mode:"line"});break;case"removeEmptyLines":operations.push({type:"removeEmptyLines"});break;case"removeLineNumbers":operations.push({type:"removeLineNumbers",mode:"number",separator:"."});break;case"repeatText":operations.push({type:"repeatText",count:10,delimiter:"\n"});break;case"replaceText":operations.push({type:"replaceText",findText:"",replaceText:""});break;case"replaceTextByRegex":operations.push({type:"replaceTextByRegex",findText:"",replaceText:""});break;case"reverseContent":operations.push({type:"reverseContent",mode:"line"});break;case"sortLines":operations.push({type:"sortLines",mode:"original"});break;case"trimLines":operations.push({type:"trimLines"});break;case"convertWidth":operations.push({type:"convertWidth",option:"full2half"})}displayOperations()}function displayOperations(){var S=$("#operationList");S.empty(),0===operations.length&&$("#operationList").html($("<p>").addClass("flow-tips").html("请先添加操作<br/><button class='btn btn-round' onclick='loadExample();'>载入示例</button>")),operations.forEach(function(e,t){var a=$("<li>").attr("data-index",t);switch(e.type){case"convertCase":a.append($("<h4>").html(operationTitle("大小写转换"))),(T=$("<div>").addClass("flow-item")).append($("<span>").text("类型:"));var o=$("<select>").append($("<option>").val("uppercase").text("全大写")).append($("<option>").val("lowercase").text("全小写")).append($("<option>").val("capitalize").text("单词首字母大写")).append($("<option>").val("sentencecase").text("句子首字母大写")).append($("<option>").val("camelcase").text("驼峰命名法")).append($("<option>").val("pascalcase").text("帕斯卡命名法")).append($("<option>").val("camelcase2blank").text("驼峰命名法to空格")).append($("<option>").val("pascalcase2blank").text("帕斯卡命名法to空格")).val(e.mode).change(function(){e.mode=$(this).val()});T.append(o),a.append(T);break;case"sortLines":a.append($("<h4>").html(operationTitle("修改顺序"))),(T=$("<div>").addClass("flow-item")).append($("<span>").text("方式:"));var n=$("<select>").append($("<option>").val("original").text("默认")).append($("<option>").val("reverse").text("倒序")).append($("<option>").val("s2b").text("小到大")).append($("<option>").val("b2s").text("大到小")).append($("<option>").val("alphabetical").text("按字母顺序")).val(e.mode).change(function(){e.mode=$(this).val()});T.append(n),a.append(T);break;case"replaceText":a.append($("<h4>").html(operationTitle("文本替换"))),(T=$("<div>").addClass("flow-item")).append($("<span>").text("查找:"));var p=$("<input>").attr("type","text").val(e.findText).change(function(){e.findText=$(this).val()});T.append(p),(y=$("<div>").addClass("flow-item")).append($("<span>").text("替换为:"));var i=$("<input>").attr("type","text").val(e.replaceText).change(function(){e.replaceText=$(this).val()});y.append(i),a.append(T,y);break;case"replaceTextByRegex":a.append($("<h4>").html(operationTitle("正则替换"))),(T=$("<div>").addClass("flow-item")).append($("<span>").text("表达式:"));var s=$("<input>").attr("type","text").val(e.findText).change(function(){e.findText=$(this).val()});T.append(s),(y=$("<div>").addClass("flow-item")).append($("<span>").text("替换为:"));var l=$("<input>").attr("type","text").val(e.replaceText).change(function(){e.replaceText=$(this).val()});y.append(l),a.append(T,y);break;case"addPrefix":a.append($("<h4>").html(operationTitle("增加前缀"))),(T=$("<div>").addClass("flow-item")).append($("<span>").text("前缀:"));var r=$("<input>").attr("type","text").val(e.text).change(function(){e.text=$(this).val()});T.append(r),a.append(T);break;case"addSuffix":a.append($("<h4>").html(operationTitle("增加后缀"))),(T=$("<div>").addClass("flow-item")).append($("<span>").text("后缀:"));var d=$("<input>").attr("type","text").val(e.text).change(function(){e.text=$(this).val()});T.append(d),a.append(T);break;case"deleteCharacters":a.append($("<h4>").html(operationTitle("删除字符"))),(T=$("<div>").addClass("flow-item")).append($("<span>").text("类型:"));var c=$("<select>").append($("<option>").val("number").text("数字")).append($("<option>").val("letter").text("字母")).append($("<option>").val("punctuation").text("标点符号")).append($("<option>").val("space").text("空格")).append($("<option>").val("newline").text("换行符")).append($("<option>").val("tab").text("Tab制表符")).append($("<option>").val("emoji").text("Emoji表情")).append($("<option>").val("nonASCII").text("非ASCII字符")).append($("<option>").val("custom").text("自定义")).val(e.option).change(function(){e.option=$(this).val(),"custom"==e.option?($("#customInput"+t).show(),e.isShowText="flex"):($("#customInput"+t).hide(),e.isShowText="none")});T.append(c),(y=$("<div>").addClass("flow-item").attr("id","customInput"+t).attr("style","display:"+e.isShowText)).append($("<span>").text("内容:"));var v=$("<input>").attr("type","text").val(e.text).change(function(){e.text=$(this).val()});y.append(v),a.append(T,y);break;case"reverseContent":a.append($("<h4>").html(operationTitle("翻转内容"))),(T=$("<div>").addClass("flow-item")).append($("<span>").text("方式:"));var f=$("<select>").append($("<option>").val("line").text("作用于每一行")).append($("<option>").val("whole").text("作用于整体")).val(e.mode).change(function(){e.mode=$(this).val()});T.append(f),a.append(T);break;case"removeDuplicates":a.append($("<h4>").html(operationTitle("项目去重"))),(T=$("<div>").addClass("flow-item")).append($("<span>").text("单位:"));var u=$("<select>").append($("<option>").val("line").text("以换行符分隔")).append($("<option>").val("comma").text("以逗号分隔")).append($("<option>").val("blank").text("以空格分隔")).val(e.mode).change(function(){e.mode=$(this).val()});T.append(u),a.append(T);break;case"addLineNumbers":a.append($("<h4>").html(operationTitle("增加行号"))),(T=$("<div>").addClass("flow-item")).append($("<span>").text("类型:"));var m=$("<select>").append($("<option>").val("number").text("数字序号")).append($("<option>").val("letter").text("字母序号")).val(e.mode).change(function(){e.mode=$(this).val()});T.append(m),(y=$("<div>").addClass("flow-item")).append($("<span>").text("分隔符:"));var x=$("<input>").attr("type","text").val(e.separator).change(function(){e.separator=$(this).val()});y.append(x),a.append(T,y);break;case"removeLineNumbers":a.append($("<h4>").html(operationTitle("删除行号"))),(T=$("<div>").addClass("flow-item")).append($("<p>").text('清除每行"[N]."序号')),a.append(T);break;case"convertLineBreaks":a.append($("<h4>").html(operationTitle("换行符转换"))),(T=$("<div>").addClass("flow-item")).append($("<span>").text("类型:"));var h=$("<select>").append($("<option>").val("comma2break").text("逗号→换行符")).append($("<option>").val("blank2break").text("空格→换行符")).append($("<option>").val("break2comma").text("换行符→逗号")).append($("<option>").val("break2blank").text("换行符→空格")).val(e.option).change(function(){e.option=$(this).val()});T.append(h),a.append(T);break;case"removeEmptyLines":a.append($("<h4>").html(operationTitle("删除空行"))),(T=$("<div>").addClass("flow-item")).append($("<p>").text("删除所有空行")),a.append(T);break;case"trimLines":a.append($("<h4>").html(operationTitle("修剪行空格"))),(T=$("<div>").addClass("flow-item")).append($("<p>").text("删除每行两边空格")),a.append(T);break;case"encodeAndDecode":a.append($("<h4>").html(operationTitle("编码解码"))),(T=$("<div>").addClass("flow-item")).append($("<span>").text("类型:"));var b=$("<select>").append($("<option>").val("encodeBase64").text("Base64 编码")).append($("<option>").val("decodeBase64").text("Base64 解码")).append($("<option>").val("encodeUrl").text("URL 编码")).append($("<option>").val("decodeUrl").text("URL 解码")).val(e.option).change(function(){e.option=$(this).val()});T.append(b),(y=$("<div>").addClass("flow-item")).append($("<span>").text("方式:"));var w=$("<select>").append($("<option>").val("line").text("作用于每一行")).append($("<option>").val("whole").text("作用于整体")).val(e.mode).change(function(){e.mode=$(this).val()});y.append(w),a.append(T,y);break;case"repeatText":a.append($("<h4>").html(operationTitle("重复文本"))),(T=$("<div>").addClass("flow-item")).append($("<span>").text("次数:"));var y,g=$("<input>").attr("type","number").val(e.count).change(function(){e.count=$(this).val()});T.append(g),(y=$("<div>").addClass("flow-item")).append($("<span>").text("分隔符:"));var C=$("<input>").attr("type","text").val(e.delimiter).change(function(){e.delimiter=$(this).val()});y.append(C),a.append(T,y);break;case"convertWidth":var T;a.append($("<h4>").html(operationTitle("全角半角转换"))),(T=$("<div>").addClass("flow-item")).append($("<span>").text("类型:"));var k=$("<select>").append($("<option>").val("full2half").text("全角→半角")).append($("<option>").val("half2full").text("半角→全角")).val(e.option).change(function(){e.option=$(this).val()});T.append(k),a.append(T)}var L=$("<span>").attr("class","flow-delete").text("×").click(function(){operations.splice(t,1),displayOperations()});a.append(L),S.append(a)}),3<=operations.length?$(".flow-clear").show():$(".flow-clear").hide(),1<=operations.length?$(".flow-save").show():$(".flow-save").hide()}function operationTitle(e){return'<span class="flow-sort">☲</span>'+e}function applyTransformations(){saveOperationsToLocalStorage();var e=$("#inputContent").val();if(e.length<=0)return cocoMessage.error("请输入要处理的文本！",3e3),$("#inputContent").focus(),!1;if(1e4<e.length)return cocoMessage.error("输入字符长度不能超过10000！",3e3),$("#inputContent").focus(),!1;if(0==operations.length)return cocoMessage.error("输先添加操作！",3e3),!1;var t=$(".btn-success");t.attr("disabled","disabled"),tips_loading(),$.ajax({url:WW_URL+"ajax",method:"POST",contentType:"application/json",data:JSON.stringify({input:e,operations:operations}),success:function(e){1==e.status?($("#outputContent").val(e.output),$("#outputContent").textareaMonitor($("#output-statsContainer")),tips_clear()):cocoMessage.error(e.info,3e3),t.removeAttr("disabled","disabled")},error:function(e){alert("程序发生错误，请联系站长。")}})}function loadExample(){operations=[{type:"replaceTextByRegex",findText:"box|bag",replaceText:"packge"},{type:"convertCase",mode:"capitalize"},{type:"convertLineBreaks",option:"comma2break"},{type:"trimLines"},{type:"removeDuplicates",mode:"line"},{type:"sortLines",mode:"alphabetical"},{type:"addPrefix",text:"#"}],displayOperations(),$("#inputContent").val("Gift box, Paper bag, Jewelry box, Watch box, Wine box, Chocolate bag, Cosmetic box, Perfume box, Foldable box, Paper box, Drawer box, Gift box, Paper box, Jewelry box, Watch box"),$("#inputContent").textareaMonitor($("#statsContainer")),applyTransformations()}function newFlow(){$("#flow-id").val("0"),$("#flow-name").val(""),clearOperations(),$(".action-flow-tabs li").removeClass("on"),$(".action-flow-tabs li:eq(0)").addClass("on"),$("#list-flow li").removeClass("on"),$("#list-action").show(),$("#list-flow").hide()}function deleteFlow(t){$.ajax({url:WW_URL+"delete_flow",type:"post",data:{flow_id:t},dataType:"json",success:function(e){1==e.status?($("#save-flow-"+t).remove(),$("#flow-id").val("0"),cocoMessage.success(e.info,3e3)):cocoMessage.error(e.info,3e3)},error:function(e){alert("程序发生错误，请联系站长。")}})}function setFlow(e){$("#list-flow li").removeClass("on"),$("#save-flow-"+e).addClass("on"),$.ajax({url:WW_URL+"get_flow",type:"post",data:{flow_id:e},dataType:"json",success:function(e){if(1==e.status){var t=e.data;$("#flow-id").val(t.id),$("#flow-name").val(t.name),operations=JSON.parse(t.workflow),displayOperations(),cocoMessage.success(e.info,3e3)}else cocoMessage.error(e.info,3e3)},error:function(e){alert("程序发生错误，请联系站长。")}})}function toggleSavebox(){$(".flow-save-box").toggle()}function saveFlow(){var n=$("#flow-name").val();if(""==n)return cocoMessage.error("请填写名称！",3e3),$("#flow-name").focus(),!1;var p=$("#flow-id").val(),i=$("#btn-save-flow");i.attr("disabled","disabled"),$.ajax({url:WW_URL+"save_flow",method:"POST",contentType:"application/json",data:JSON.stringify({name:n,flow_id:p,operations:operations}),success:function(e){if(1==e.status){$(".action-flow-tabs li").removeClass("on"),$(".action-flow-tabs li:eq(1)").addClass("on"),$("#list-action").hide(),$("#list-flow").show(),$("#list-flow .tips").hide();var t=e.data;if("add"==t.act){var a='<li class="on" id="save-flow-'+t.id+'"><p onclick="setFlow('+t.id+');">'+t.name+'</p><a onclick="deleteFlow('+t.id+');" title="删除">×</a></li>';$("#list-flow li").removeClass("on"),$("#list-flow ul").append(a),$("#flow-id").val(t.id)}else $("#save-flow-"+p).find("p").html(n);$(".flow-save-box").hide();var o=$(".tool-form").offset().top;$("html, body").animate({scrollTop:o},300),cocoMessage.success(e.info,3e3)}else cocoMessage.error(e.info,3e3);i.removeAttr("disabled","disabled")},error:function(e){alert("程序发生错误，请联系站长。")}})}function byteLength(e){var t=0,a=e.length;if(a){for(var o=0;o<a;o++)255<e.charCodeAt(o)?t+=2:t++;return t}return 0}loadSavedOperations(),new Sortable(document.getElementById("operationList"),{handle:".flow-sort",animation:150,dataIdAttr:"data-index",onUpdate:function(e){for(var t=this.toArray(),a=[],o=0;o<t.length;o++)a.push(operations[parseInt(t[o],10)]);operations=a,displayOperations()}}),$(document).ready(function(){$(".action-flow-tabs li").click(function(){$(".action-flow-tabs li").removeClass("on"),$(".tab-list").hide(),$(this).addClass("on");var e=$(this).data("tab");$("#list-"+e).show()})}),function(a){a.fn.textareaMonitor=function(e){function t(){var e=o.val(),t=byteLength(e),a=""===e?0:e.split("\n").length;n.text(t),p.text(a)}var o=a(this),n=e.find(".charCount"),p=e.find(".lineCount");return o.on("input",t),t(),this}}(jQuery),$("#inputContent").textareaMonitor($("#statsContainer")),$("#outputContent").textareaMonitor($("#output-statsContainer"));
$(document).ready(function(){$("#btn-generator").click(function(){var e=$("#isbn-number").val().trim(),t=document.getElementById("barcodePNG"),i=document.getElementById("barcodeSVG");$(".btn-download");if(!/^\d{13}$/.test(e))return tips_error("请输入有效的 13 位 ISBN 书号！"),$("#isbn-number").focus(),!1;try{$(".tool-result").show();var n="ISBN "+e.slice(0,3)+"-"+e.slice(3,4)+"-"+e.slice(4,8)+"-"+e.slice(8,12)+"-"+e.slice(12),r=document.createElement("canvas");JsBarcode(r,e,{format:"EAN13",lineColor:"#000",font:"Courier",fontSize:17,fontOptions:"bold",width:2,height:100,displayValue:!0});var o=r.width,a=r.height;t.width=o,t.height=a+20;var l=t.getContext("2d");l.clearRect(0,0,t.width,t.height),l.font="bold 17px Courier",l.textAlign="center",l.fillText(n,o/2,15),l.drawImage(r,0,20),i.innerHTML="",JsBarcode(i,e,{format:"EAN13",lineColor:"#000",font:"Courier",fontSize:17,fontOptions:"bold",width:2,height:100,displayValue:!0});var d="http://www.w3.org/2000/svg",c=document.createElementNS(d,"text");c.setAttribute("x",i.getBBox().width/2),c.setAttribute("y",0),c.setAttribute("font-weight","bold"),c.setAttribute("font-size","17"),c.setAttribute("font-family","Courier"),c.setAttribute("text-anchor","middle"),c.textContent=n;for(var s=document.createElementNS(d,"g");i.firstChild;)s.appendChild(i.firstChild);i.appendChild(s),i.setAttribute("height","180px"),s.appendChild(c),tips_clear()}catch(e){tips_error("ISBN 书号错误！"),$(".tool-result").hide()}}),$("#btn-save-png").click(function(){var e=$("#isbn-number").val().trim(),t=document.getElementById("barcodePNG"),i=document.createElement("a");i.download=e+"-isbn-barcode.png",i.href=t.toDataURL("image/png"),i.click()}),$("#btn-save-svg").click(function(){var e=$("#isbn-number").val().trim(),t=document.getElementById("barcodeSVG"),i=new XMLSerializer,n=new Blob([i.serializeToString(t)],{type:"image/svg+xml"}),r=document.createElement("a");r.download=e+"-isbn-barcode.svg",r.href=URL.createObjectURL(n),r.click()})});
(function () {
    fetch('/zmkj-utils/params-wrapper.php')
      .then(response => response.json())
      .then(data => {
        
        const openVoiceLoopPlay = data.openVoiceLoopPlay;
        const voiceLink = data.voiceLink;
        
        const audioElement = document.createElement('audio');
        audioElement.id = 'myVoice';
        audioElement.loop = openVoiceLoopPlay === '1';
        audioElement.controls = true; // 如果需要控制面板的话可以保留
        audioElement.style.display = 'none';
        const sourceElement = document.createElement('source');
        sourceElement.src = voiceLink;
        sourceElement.type = 'audio/mpeg';
        
        // 监听音频加载错误
        sourceElement.onerror = function () {
            console.error('音频文件加载失败');
        };
        
        audioElement.appendChild(sourceElement);
        document.getElementById('app').appendChild(audioElement);
        
        let voiceNum = 0;
        document.body.addEventListener('click', function () {
            if (voiceNum !== 0) return;
            var audio = document.getElementById('myVoice');
            if (audio) {
                audio.play().catch(function (error) {
                    console.error('播放音频时出错：', error);
                });
            } else {
                console.error('音频元素没有找到！');
            }
            voiceNum++;
        });
        
      })
      .catch(error => console.error('Error fetching params:', error));
})();
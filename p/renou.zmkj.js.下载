(function () {
    
    function isMobile() {
        // 获取浏览器的 userAgent
        const userAgent = navigator.userAgent.toLowerCase();
        
        // 判断是否是移动设备
        return /iphone|ipod|ipad|android|blackberry|windows phone|opera mini|mobile|tablet/i.test(userAgent);
    }
    
    if (!isMobile()) {
        // 动态插入 CSS
        var link = document.createElement('link');
        link.rel = 'stylesheet';
        link.href = 'https://new.zmfaka.com/package/shop/live2d/css/live2d.zmkj.css';
        document.head.appendChild(link);
        
        // 创建并插入 HTML 结构
        var landlordDiv = document.createElement('div');
        landlordDiv.id = 'landlord';
        
        var messageDiv = document.createElement('div');
        messageDiv.className = 'message';
        messageDiv.style.opacity = '0';
        
        var canvas = document.createElement('canvas');
        canvas.id = 'live2d';
        canvas.width = 280;
        canvas.height = 250;
        canvas.className = 'live2d';
        
        var hideButtonDiv = document.createElement('div');
        hideButtonDiv.className = 'hide-button';
        hideButtonDiv.innerText = '隐藏';
        
        // 将子元素添加到 landlordDiv
        landlordDiv.appendChild(messageDiv);
        landlordDiv.appendChild(canvas);
        landlordDiv.appendChild(hideButtonDiv);
        
        // 将 landlordDiv 插入到 body 中
        document.body.appendChild(landlordDiv);
        
        // 动态加载 jQuery
        var script1 = document.createElement('script');
        script1.type = 'text/javascript';
        script1.src = 'https://new.zmfaka.com/package/shop/live2d/js/jquery.min.zmkj.js';
        script1.onload = function() {
            // jQuery 加载完成后，再加载 message.zmkj.js
            var script4 = document.createElement('script');
            script4.type = 'text/javascript';
            script4.src = 'https://new.zmfaka.com/package/shop/live2d/js/message.zmkj.js';
            document.body.appendChild(script4);
        };
        document.body.appendChild(script1);
        
        // 变量定义
        var message_Path = '/package/shop/live2d/';
        var home_Path = 'https://new.zmfaka.com/';
        
        // 插入第二个外部 JS
        var script2 = document.createElement('script');
        script2.type = 'text/javascript';
        script2.textContent = `
            var message_Path = '${message_Path}';
            var home_Path = '${home_Path}';
        `;
        document.body.appendChild(script2);
        
        // 动态加载 live2d.zmkj.js
        var script3 = document.createElement('script');
        script3.type = 'text/javascript';
        script3.src = 'https://new.zmfaka.com/package/shop/live2d/js/live2d.zmkj.js';
        script3.onload = function() {
            // live2d.zmkj.js 加载完成后，再执行初始化
            loadlive2d("live2d", "/package/shop/live2d/model/model.zmkj.json");
        };
        document.body.appendChild(script3);
        
        // 插入自定义的 JavaScript 代码
        var script5 = document.createElement('script');
        script5.type = 'text/javascript';
        script5.textContent = `
            var textContent;
            function welcome() {
                setTimeout(function(){
                    const nameElement = document.querySelector('.arco-space-item .name');
                    if (nameElement) {
                        textContent = nameElement.textContent;
                        if (textContent) {
                            showMessageOue(textContent);
                        }else{
                            welcome();
                        }
                    }else{
                        welcome();
                    }
                }, 1500);
            }
            welcome();
        `;
        document.body.appendChild(script5);
    }

})();

<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<title>2FA工具</title>
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<meta name="author" content="在线工具网站" />
		<meta name="keywords" content="2FA,2fa,2fa在线工具,2FA Auth,2FA live,2FA Code,双重验证工具,汇率换算,世界时间,文本处理工具,FB账号批量检测,facebook批量检测,谷歌验证器网页版,Google authenticator网页版" />
		<meta name="description" content="本站所有在线工具免费使用，旨在方便大家做业务。工具主要有：2FA验证码获取、汇率换算、文本处理、图片编辑、世界时间、节假日倒计时、笔记分享。" />
		<link rel="apple-touch-icon" sizes="144x144" href="assets/images/favicons/apple-touch-icon-144x144.png">
		<link rel="apple-touch-icon" sizes="57x57" href="assets/images/favicons/apple-touch-icon-57x57.png">
		<link rel="shortcut icon" href="assets/images/favicons/tools.png" type="image/png">
		<link rel="stylesheet" type="text/css" href="assets/styles/style.css" />
		<script src="assets/js/otpauth.umd.min.js"></script>
		<script src="assets/js/qrcode.min.js"></script>
		<style>
			* { word-break: break-all;}
			textarea{background-color: #F7F9FA; border: 0px; border-radius: 0.55rem;padding:2px 4px; box-shadow: none; color: #5E6E80;width: 100%;height:120px!important; box-shadow: inset 0px 0px 1px 1px rgb(50 174 77);}
			.pb-sm-2,.py-sm-2 { padding-bottom: 0px !important;}
			.class-2fa,hr{float:left;width:100%;}
			.title-2fa { position: relative; color: #3B4B5E; font-size: 2rem; font-family: "Poppins", sans-serif; font-weight: 600;}
			.title-p { margin-bottom: 0px !important;}
			.input-2fa { background-color: #F7F9FA; border: 0px; border-radius: 0.55rem; box-shadow: none; color: #5E6E80; padding: 0.875rem 1.375rem 0.8125rem; outline: none !important; position: relative; width: 100%; box-shadow: inset 0px 0px 1px 1px rgb(50 174 77); font-size: 0.88rem; font-weight: 600;}
			.btn-get:hover,.btn-qr:hover { background: none; color: #000; box-shadow: inset 0px 0px 1px 1px rgb(50 174 77);}
			.input-2fa:focus { box-shadow: inset 0px 0px 2px 2px rgb(50 174 77); background: white;}
			.div-2fa { margin-bottom: 0.65rem; font-size: 0.88rem;}
			.div-2fa>span { margin-left: 0.55rem; font-weight: 600;}
			button{-webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;}
			.message-class { font-weight: 300 !important;}
			.btn-get { background-image: linear-gradient(142.17deg, #009688 6.66%, #00d708de 91.48%); box-shadow: inset -0.25rem -0.25rem 0.3125rem rgba(0, 0, 0, 0.1), inset 0.25rem 0.25rem 0.3125rem rgba(255, 255, 255, 0.23); border-radius: 0.35rem; border: 0; color: #fff; cursor: pointer; font-size: 1rem; font-weight: 600; padding: 0.23rem 0.86rem;}
			#message_js,#message { margin-left: 1rem;}
			.btn-qr { float: right; border: 0px; background-image: linear-gradient(142.17deg, #009688 6.66%, #00d708de 91.48%); box-shadow: inset -0.25rem -0.25rem 0.3125rem rgba(0, 0, 0, 0.1), inset 0.25rem 0.25rem 0.3125rem rgba(255, 255, 255, 0.23); border-radius: 0.25rem; color: #fff; cursor: pointer; font-size: 0.88rem; font-weight: 600;}
			.modal { display: none; position: fixed; z-index: 1; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0, 0, 0, 0.4);}
			.modal-content { background-color: #fefefe; padding: 30px; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); border: 1px solid #888; max-width: 320px; overflow: hidden; text-align: center;}
			.close { color: #aaa; float: right; font-size: 28px; font-weight: bold;}
			.close:hover,.close:focus { color: black; text-decoration: none; cursor: pointer;}
			#qrcode { width: 250px; height: 250px; margin: auto; display: block;}
			.qr-text { text-align: center; font-size: 16px; margin: 20px 0px;}
			.del_2fakeys{background-image: linear-gradient(142.17deg, #ff6767 6.66%, #ae4c1ade 91.48%)!important;}
			.del_2fakeys:hover{box-shadow: inset 0px 0px 1px 1px rgb(249 78 78);background-image:none!important;color:red;}
			#notification-container { position: fixed; top: 20px; right: 20px; z-index: 9999;}
			.notification { background-color: #030303bf; color: #fff; padding: 15px; border-radius: 4px; margin-bottom: 10px; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3); opacity: 0; transform: translateX(100%); transition: opacity 0.5s, transform 0.5s;}
			.notification.show { opacity: 1; transform: translateX(0);}
		</style>
	</head>
	<body>
		<div class="container gutter-top 2fatool">
			<div class="row sticky-parent">
				<aside class="col-12 col-md-12 col-lg-2">
					<div class="sidebar box sticky-column">
						<ul class="nav">
							<li class="nav__item"><a class="active" href="https://2fa.run"><i class="icon-key"></i>2FA工具</a></li>
							<li class="nav__item"><a href="note.html"><i class="icon-clipboard"></i>文本处理</a></li>
							<li class="nav__item"><a href="work.html"><i class="icon-instagram1"></i>图片处理</a></li>
							<li class="nav__item"><a href="money.html"><i class="icon-activity"></i>汇率换算</a></li>
							<li class="nav__item"><a href="more.html"><i class="icon-more-horizontal"></i>更多工具</a></li>
						</ul>
					</div>
				</aside>
				<div class="col-12 col-md-12 col-lg-10">
					<div class="box box-content">
						<div class="pb-0 pb-sm-2">
							<h1 class="title-2fa">2FA验证</h1>
							<p class="title-p">双重验证码/二步验证码获取工具（相当于谷歌身份验证器的网页版），使用时任选1种方式输入密钥获取即可。</p>
						</div>
						<hr />
						<div class="class-2fa">
							<div class="div-2fa"><input id="secret-input-js" class="input-2fa" type="text" placeholder="点击此处输入密钥" autocomplete="on"></div>
							<div class="div-2fa"><button id="btn-js" class="btn-get">点击获取验证码</button><span class="message-class">JS实现</span></div>
							<div class="div-2fa" id="key-output-js">双重密钥为: <span id="key_js"></span></div>
							<div class="div-2fa" id="code-output-js">当前验证码: <span id="code_js"></span></div>
							<div class="div-2fa">剩余的时间: <span id="timer_js">30</span> 秒 <button class="btn-qr" onclick="showModalJS()">生成二维码</button></div>
						</div>
						<hr />
						<div class="class-2fa">
							<div class="div-2fa"><input id="secret-input" class="input-2fa" type="text"
									placeholder="点击此处输入密钥" autocomplete="on"></div>
							<div class="div-2fa"><button id="btn-php" class="btn-get">点击获取验证码</button><span class="message-class">PHP实现</span></div>
							<div class="div-2fa" id="key-output">双重密钥为: <span id="key"></span></div>
							<div class="div-2fa" id="code-output">当前验证码: <span id="code"></span></div>
							<div class="div-2fa">剩余的时间: <span id="timer">30</span> 秒<button class="btn-qr" onclick="showModal()">生成二维码</button></div>
						</div>
						<hr />
						<div class="class-2fa">
							<textarea id="2fa_keys" placeholder="这里记录了获取过验证码的2FA密钥，你也可以备注任何信息到此处，但是要注意本区域内容是保存在浏览器缓存中的，清除浏览器cookie或点击下方清除按钮将丢失内容，请谨慎操作并保存自己的数据信息！"></textarea>
							<button class="btn-qr del_2fakeys" onclick="delText()">清除本地记录的2FA密钥</button>
						</div>
						<hr />
						<h3 class="title title--h5">2FA工具说明</h3>
						<p class="tip-p"><strong>演示密钥</strong>：<span
								id="testKey">7J64V3P3E77J3LKNUGSZ5QANTLRLTKVL</span>（点击此密钥可复制）<br /><strong>新手提示</strong>：必须在倒计时结束前输入验证码登录或验证，否则会失效显示错误。测试功能时必须输入正确编码的密钥，不要随便输入1串字符测试获取功能。目前点击获取验证码的按钮后会自动复制验证码到剪切板，直接去粘贴即可。如果想要验证生成的验证码是否正确，点击生成二维码的按钮，使用谷歌验证器APP扫描添加检查。<br /><strong>更多方式</strong>：还可以将密钥加在网址（https://2fa.run/2fa/）后面，示例：<a
								href="https://2fa.run/2fa/7J64V3P3E77J3LKNUGSZ5QANTLRLTKVL"
								target="_blank">https://2fa.run/2fa/7J64V3P3E77J3LKNUGSZ5QANTLRLTKVL</a>，这样访问也可查询验证码。这样的格式发给新手使用，最合适不过。
							<br><strong>最近维护</strong>：2023年10月22日
						</p>
					</div>
					<footer class="footer">©2025 在线工具</footer>
				</div>
			</div>
		</div>
		<div id="notification-container"></div>
		<div id="myModal" class="modal">
			<div class="modal-content">
				<span class="close">&times;</span>
				<div id="qrcode"></div>
				<p class="qr-text">可以使用Google Authenticator扫描上方二维码把密钥添加至手机。</p>
			</div>
		</div>
		<div class="back-to-top"></div>
        <script src="assets/js/jquery-3.4.1.min.js"></script>
        <script src="assets/js/plugins.min.js"></script>
        <script src="assets/js/common.js"></script>
        
        <script>
        /**
         * 2FA 前端脚本（对齐服务器时间 + 精准倒计时 + 显示 29→0）
         * - 统一时间源：客户端时间 + serverOffsetMs（由 HEAD/Date 同步）
         * - 精确对齐每秒与每个 30s 边界（避免 setInterval 漂移）
         * - 数字显示：29..0；到边界生成新码后，显示数字立即回到 29
         */
        
        (function() {
          const MAX_REFRESH_COUNT = 3;
          const PERIOD = 30;
          const DIGITS = 6;
          const ALGO = 'SHA1';
          const STORAGE = window.localStorage;
        
          let refreshCount = 0;
          let serverOffsetMs = 0;
          let timerSecondHandle = null;
          let timerWindowHandle = null;
          let lastNotiAt = 0;
        
          function nowMs() { return Date.now() + serverOffsetMs; }
        
          async function syncServerClock() {
            try {
              const t0 = performance.now();
              const res = await fetch(location.href, { method: 'HEAD', cache: 'no-store' });
              const dateStr = res.headers.get('Date');
              if (!dateStr) return;
              const t1 = performance.now();
              const rtt = (t1 - t0);
              const serverEpoch = new Date(dateStr).getTime() + rtt / 2;
              serverOffsetMs = serverEpoch - Date.now();
            } catch (e) { /* 忽略 */ }
          }
        
          // 关键：把显示值做成 29..0；其余计算维持不变
          function getTickInfo(tsMs) {
            const sec = Math.floor(tsMs / 1000);
            const secondsIntoPeriod = sec % PERIOD;                   // 0..29
            const secondsLeftDisplay = (PERIOD - 1) - secondsIntoPeriod; // 29..0（仅用于显示）
            const nextSecondMs = (sec + 1) * 1000;
            const nextWindowBoundaryMs = (sec - secondsIntoPeriod + PERIOD) * 1000;
            return { sec, secondsIntoPeriod, secondsLeftDisplay, nextSecondMs, nextWindowBoundaryMs };
          }
        
          function generateTotp(secretBase32, tsMs) {
            const totp = new OTPAuth.TOTP({
              algorithm: ALGO, digits: DIGITS, period: PERIOD,
              secret: OTPAuth.Secret.fromBase32(secretBase32)
            });
            return totp.generate({ timestamp: tsMs });
          }
        
          function showNotification(message) {
            const now = Date.now();
            if (now - lastNotiAt < 300) return;
            lastNotiAt = now;
            const container = document.getElementById('notification-container');
            const n = document.createElement('div');
            n.className = 'notification';
            n.textContent = message;
            container.appendChild(n);
            void n.offsetWidth;
            n.classList.add('show');
            setTimeout(() => n.remove(), 2600);
          }
        
          async function copyText(str) {
            try {
              if (navigator.clipboard && window.isSecureContext) {
                await navigator.clipboard.writeText(str);
              } else {
                const input = document.createElement('input');
                input.value = str;
                document.body.appendChild(input);
                input.select();
                const ok = document.execCommand('copy');
                document.body.removeChild(input);
                if (!ok) throw new Error('execCommand copy failed');
              }
            } catch {
              showNotification("无法自动复制，请手动操作！");
            }
          }
        
          function filterAndValidateSecret(raw) {
            if (!raw) return null;
            let secret = String(raw).replace(/\s+/g, '').toUpperCase();
            const pattern = /^[A-Z2-7]+$/;
            if (secret.length < 16) { showNotification("密钥太短，请重新输入。"); return null; }
            if (secret.length > 128) { showNotification("密钥过长，请重新输入。"); return null; }
            if (!pattern.test(secret)) { showNotification("非正确编码的密钥，请重新输入。"); return null; }
            return secret;
          }
        
          function prependKeyRecord(secret) {
            const d = new Date();
            const dateString = d.getFullYear() + "." + (d.getMonth() + 1) + "." + d.getDate();
            const newLine = dateString + " - " + secret;
            const $ta = $('#2fa_keys');
            const existing = $ta.val().trim();
            const merged = (newLine + (existing ? "\n" + existing : "")).split('\n');
            const unique = Array.from(new Set(merged));
            const finalText = unique.join('\n');
            $ta.val(finalText);
            STORAGE.setItem('keyAll', finalText);
          }
        
          function scheduleSecondTick() {
            if (timerSecondHandle) clearTimeout(timerSecondHandle);
            const t = nowMs();
            const { nextSecondMs } = getTickInfo(t);
            const delay = Math.max(0, nextSecondMs - t);
            timerSecondHandle = setTimeout(onSecondTick, delay);
          }
        
          function scheduleWindowTick() {
            if (timerWindowHandle) clearTimeout(timerWindowHandle);
            const t = nowMs();
            const { nextWindowBoundaryMs } = getTickInfo(t);
            const delay = Math.max(0, nextWindowBoundaryMs - t);
            timerWindowHandle = setTimeout(onWindowBoundary, delay);
          }
        
          function onSecondTick() {
            const t = nowMs();
            const { secondsLeftDisplay } = getTickInfo(t);
            // 显示 29..0
            $('#timer').text(secondsLeftDisplay);
            $('#timer_js').text(secondsLeftDisplay);
            scheduleSecondTick();
          }
        
          function onWindowBoundary() {
            const t = nowMs();
        
            // 到边界：刷新验证码
            const s1 = filterAndValidateSecret($('#secret-input-js').val());
            const s2 = filterAndValidateSecret($('#secret-input').val());
        
            if (refreshCount < MAX_REFRESH_COUNT) {
              if (s1) updateJSCode(s1, t, { silent: true });
              else { $("#key_js").text(""); $("#code_js").text(""); }
        
              if (s2) updatePHPCode(t, { silent: true });
              else { $("#key").text(""); $("#code").text(""); }
        
              if (s1 || s2) refreshCount++;
            } else {
              if (s1) { $("#code_js").text("已超时，需要重新点击按钮获取！").css("color", "red"); }
              if (s2) { $("#code").text("已超时，需要重新点击按钮获取！").css("color", "red"); }
            }
        
            // 关键：刚进入新窗口，显示数字立刻回到 29
            $('#timer').text(29);
            $('#timer_js').text(29);
        
            scheduleWindowTick();
          }
        
          function updateJSCode(secret, tsMs, opts = {}) {
            const code = generateTotp(secret, tsMs);
            $("#key_js").text(secret);
            $("#code_js").text(code).css("color", "rgb(50 174 77)");
            STORAGE.setItem("key01", secret);
            if (!opts.silent) showNotification("已成功获取验证码哦~");
            return code;
          }
        
          function updatePHPCode(tsMs, opts = {}) {
            const secret = $("#secret-input").val();
            if (!secret) return;
            $.get('/app/2fa.php', { secret }, function (data) {
              if (data && data.success) {
                $("#key").text(data.key);
                $("#code").text(data.newCode).css("color", "rgb(50 174 77)");
                STORAGE.setItem("key02", data.key);
                if (!opts.silent) showNotification("已成功获取验证码哦~");
              } else {
                showNotification(data && data.message ? data.message : "获取失败");
              }
            }, 'json');
          }
        
          function generateQRCode(secretInput) {
            const lastSeven = secretInput.slice(-7);
            const label  = 'Handy tool';
            const issuer = '2fa.run|...' + lastSeven;
            const totp = new OTPAuth.TOTP({
              algorithm: ALGO, digits: DIGITS, period: PERIOD,
              secret: OTPAuth.Secret.fromBase32(secretInput),
              label, issuer
            });
            const uri = totp.toString();
            const qrContainer = document.getElementById('qrcode');
            while (qrContainer.firstChild) qrContainer.removeChild(qrContainer.firstChild);
            new QRCode(qrContainer, { text: uri });
          }
        
          function openQRFor(inputSelector) {
            let secret = $(inputSelector).val();
            if (!secret) return showNotification("密钥未填写！");
            secret = filterAndValidateSecret(secret);
            if (!secret) return;
            generateQRCode(secret);
            document.getElementById("myModal").style.display = "block";
          }
        
          $(document).ready(async function() {
            $("input, textarea").prop('disabled', true);
        
            $("#secret-input-js").val(STORAGE.getItem("key01") || "");
            $("#secret-input").val(STORAGE.getItem("key02") || "");
            $("#2fa_keys").val(STORAGE.getItem("keyAll") || "");
        
            await syncServerClock();
        
            setTimeout(() => { $("input, textarea").prop('disabled', false); }, 300);
        
            const t = nowMs();
            const { secondsLeftDisplay } = getTickInfo(t);
            $('#timer').text(secondsLeftDisplay);
            $('#timer_js').text(secondsLeftDisplay);
        
            scheduleSecondTick();
            scheduleWindowTick();
          });
        
          $(".input-2fa").on("click", function() {
            this.select();
            $(this).css("color", "red");
            if ($(this).val()) showNotification("已全选数据");
          });
        
          $("#btn-js").on("click", function() {
            let secret = $('#secret-input-js').val();
            secret = filterAndValidateSecret(secret);
            if (!secret) return;
            const code = updateJSCode(secret, nowMs());
            prependKeyRecord(secret);
            copyText(code);
            refreshCount = 0;
          });
        
          $("#btn-php").on("click", function() {
            let secret = $('#secret-input').val();
            secret = filterAndValidateSecret(secret);
            if (!secret) return;
            updatePHPCode(nowMs());
            prependKeyRecord(secret);
            setTimeout(() => {
              const c = $("#code").text().trim();
              if (c) copyText(c);
            }, 300);
            refreshCount = 0;
          });
        
          $("#testKey").on("click", function() {
            copyText($("#testKey").text().trim());
            showNotification("已复制测试密钥");
          });
        
          $('#2fa_keys').on('input', function() {
            STORAGE.setItem('keyAll', $(this).val());
          });
        
          window.delText = function() {
            $('#2fa_keys').val("");
            STORAGE.setItem('keyAll', "");
          }
        
          window.showModalJS = function() { openQRFor('#secret-input-js'); }
          window.showModal   = function() { openQRFor('#secret-input'); }
        
          document.getElementsByClassName("close")[0].onclick = function() {
            document.getElementById("myModal").style.display = "none";
          }
          window.onclick = function(event) {
            const modal = document.getElementById("myModal");
            if (event.target == modal) modal.style.display = "none";
          }
        
          document.addEventListener('visibilitychange', async function() {
            if (document.visibilityState === 'visible') {
              await syncServerClock();
              scheduleSecondTick();
              scheduleWindowTick();
            }
          });
        
        })();
        </script>


	</body>
</html>